import{aE as $,M as g,y as u,m as L,o as M,c as P,w as s,H as d,a as e,I as m,K as N,aj as z,a8 as b}from"./index.55ec1fa1.js";import{Q as G}from"./QSpinnerDots.00537bd1.js";import{Q as H,a as I,b as F,c as _,d as O}from"./QTable.a9ca3087.js";import{Q as K,b as U,a as h}from"./QPage.116c91c2.js";import{Q as J,a as V}from"./QForm.30c49008.js";import{Q as S,a as D,C as Q}from"./ClosePopup.4b52164a.js";import{u as W}from"./use-quasar.485ffa18.js";import"./format.03fbf766.js";import"./selection.d802a799.js";import"./QList.bdc0d16e.js";import"./use-key-composition.9a8b945e.js";const X=$("user",{state:()=>({users:[],currentUser:null,loading:!1,error:null}),actions:{async getAllUsers(){try{this.loading=!0;const r=await g.get("/users");return this.users=r.data,r.data}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async createUser(r){try{return this.loading=!0,(await g.post("/users",r)).data}catch(t){throw this.error=t.message,t}finally{this.loading=!1}},async updateUser(r,t){try{return this.loading=!0,(await g.put(`/users/${r}`,t)).data}catch(i){throw this.error=i.message,i}finally{this.loading=!1}},async deleteUser(r){try{this.loading=!0,await g.delete(`/users/${r}`)}catch(t){throw this.error=t.message,t}finally{this.loading=!1}}}}),Y={class:"q-pa-md"},Z={class:"row q-mb-md"},ee={class:"col-auto"},ae={class:"text-h6"},fe={__name:"UserList",setup(r){const t=W(),i=X(),v=u(!1),k=u([]),f=u(!1),y=u(!1),p=u(!1),c=u(null),x=[{name:"username",label:"Username",field:"username",align:"left"},{name:"fullName",label:"Nama Lengkap",field:"fullName",align:"left"},{name:"role",label:"Role",field:"role",align:"left"},{name:"actions",label:"Actions",field:"actions",align:"center"}],E=["VENDOR","EM","USER"],n=u({username:"",password:"",fullName:"",role:null}),j=()=>{n.value={username:"",password:"",fullName:"",role:null}},w=async()=>{v.value=!0;try{const o=await i.getAllUsers();k.value=o}catch{t.notify({type:"negative",message:"Gagal memuat daftar user"})}finally{v.value=!1}},A=()=>{p.value=!1,j(),f.value=!0},B=o=>{p.value=!0,c.value=o,n.value={username:o.username,password:"",fullName:o.fullName,role:o.role},f.value=!0},T=o=>{c.value=o,y.value=!0},C=async()=>{var o,l;try{p.value?(await i.updateUser(c.value.id,n.value),t.notify({type:"positive",message:"User berhasil diperbarui"})):(await i.createUser(n.value),t.notify({type:"positive",message:"User berhasil ditambahkan"})),f.value=!1,w()}catch(a){t.notify({type:"negative",message:((l=(o=a.response)==null?void 0:o.data)==null?void 0:l.message)||"Gagal menyimpan user"})}},q=async()=>{try{await i.deleteUser(c.value.id),t.notify({type:"positive",message:"User berhasil dihapus"}),w()}catch{t.notify({type:"negative",message:"Gagal menghapus user"})}};return L(()=>{w()}),(o,l)=>(M(),P(K,{padding:""},{default:s(()=>[d("div",Y,[d("div",Z,[l[6]||(l[6]=d("div",{class:"col"},[d("div",{class:"text-h6"},"Manajemen User")],-1)),d("div",ee,[e(m,{color:"primary",icon:"add",label:"Tambah User",onClick:A})])]),e(U,null,{default:s(()=>[e(H,{rows:k.value,columns:x,"row-key":"id",loading:v.value},{loading:s(()=>[e(I,{showing:"",color:"primary"},{default:s(()=>[e(G,{size:"50px"})]),_:1})]),"body-cell-actions":s(a=>[e(F,{props:a},{default:s(()=>[e(m,{flat:"",round:"",color:"primary",icon:"edit",size:"sm",onClick:R=>B(a.row)},{default:s(()=>[e(_,null,{default:s(()=>l[7]||(l[7]=[N("Edit")])),_:1})]),_:2},1032,["onClick"]),e(m,{flat:"",round:"",color:"negative",icon:"delete",size:"sm",onClick:R=>T(a.row)},{default:s(()=>[e(_,null,{default:s(()=>l[8]||(l[8]=[N("Hapus")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),e(D,{modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=a=>f.value=a),persistent:""},{default:s(()=>[e(U,{style:{"min-width":"350px"}},{default:s(()=>[e(h,null,{default:s(()=>[d("div",ae,z(p.value?"Edit User":"Tambah User"),1)]),_:1}),e(h,null,{default:s(()=>[e(J,{onSubmit:C,class:"q-gutter-md"},{default:s(()=>[e(V,{modelValue:n.value.username,"onUpdate:modelValue":l[0]||(l[0]=a=>n.value.username=a),label:"Username",rules:[a=>!!a||"Username wajib diisi"],disable:p.value},null,8,["modelValue","rules","disable"]),e(V,{modelValue:n.value.password,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.password=a),label:"Password",type:"password",rules:[a=>!p.value||!!a||"Password wajib diisi"]},null,8,["modelValue","rules"]),e(V,{modelValue:n.value.fullName,"onUpdate:modelValue":l[2]||(l[2]=a=>n.value.fullName=a),label:"Nama Lengkap",rules:[a=>!!a||"Nama lengkap wajib diisi"]},null,8,["modelValue","rules"]),e(O,{modelValue:n.value.role,"onUpdate:modelValue":l[3]||(l[3]=a=>n.value.role=a),options:E,label:"Role",rules:[a=>!!a||"Role wajib dipilih"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(S,{align:"right"},{default:s(()=>[b(e(m,{flat:"",label:"Batal",color:"primary"},null,512),[[Q]]),e(m,{flat:"",label:"Simpan",color:"primary",onClick:C})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:y.value,"onUpdate:modelValue":l[5]||(l[5]=a=>y.value=a),persistent:""},{default:s(()=>[e(U,null,{default:s(()=>[e(h,{class:"row items-center"},{default:s(()=>l[9]||(l[9]=[d("span",{class:"q-ml-sm"},"Apakah Anda yakin ingin menghapus user ini?",-1)])),_:1}),e(S,{align:"right"},{default:s(()=>[b(e(m,{flat:"",label:"Batal",color:"primary"},null,512),[[Q]]),b(e(m,{flat:"",label:"Hapus",color:"negative",onClick:q},null,512),[[Q]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{fe as default};
